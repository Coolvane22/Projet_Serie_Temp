---
title: "projet"
author: "Amélie GOUTARD"
date: '2022-04-07'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Importation librairies
```{r}
library(tidyverse)
library(lubridate)
library(forecast)
library(plyr)
library(plotly)
library(xts)
```

# Importation et traitements des données 
Source des données : https://www.insee.fr/fr/statistiques/series/102765746
```{r}
## on importe
caracteristiques <- read_delim("caractéristiques.csv", delim =";")
v_mensuelles <- read_delim("valeurs_mensuelles.csv", delim =",")
head(caracteristiques)
head(v_mensuelles)

## on garde uniquement les colonnes utiles
vm_depenses <- v_mensuelles %>% 
  select("Libellé","Situation mensuelle du budget de l'État - Dépenses - Cumul depuis le début de l'année" )

colnames(vm_depenses) <- c("date", "depenses")

## on veut la colonne date au format date
vm_depenses$date <- ym(vm_depenses$date)

## si on ne veut pas cumulé
for (j in 1:13){
  for (i in 2:12){
     vm_depenses[i+((j-1)*12),2]<-vm_depenses[i+((j-1)*12),2]-sum(vm_depenses[(1+((j-1)*12)):((i-1)+((j-1)*12)),2])
   }
}

```


```{r}
## month.plot 
ts = ts(vm_depenses$depenses, frequency=12)
forecast::ggmonthplot(ts)

## on represente la serie brute
ts %>% 
  ggtsdisplay(
    plot.type = "scatter"
  )

### tendance ?
## degre 1 : semble bien
ts %>% 
  diff(
    differences = 1
  ) %>% 
  ggtsdisplay(
    plot.type = "scatter"
  )
# moyenne
mean(ts %>% 
  diff( differences = 1) 
) # 84.95513

## degre 2
ts %>% 
  diff(
    differences = 2
  ) %>% 
  ggtsdisplay(
    plot.type = "scatter"
  )
# moyenne
mean(ts %>% 
  diff( differences = 2) 
) # -174.1355

## on enleve la tendance (diff de 1)
serie_wo_tendance <- diff(ts, differences=1)
plot(serie_wo_tendance)

### saisonnalité ?
plot(diff(serie_wo_tendance, lag=12))

# on enleve la saisonnalité
acf(diff(serie_wo_tendance, lag=12))
```
esperance constante ? oui
voir la variance pour la stationnarité
estimer un ar
estimer un ma
on oppose et on choisit
regression lineaire generalise pour estimer ar et ma

```{r}

```



Etapes à effectuer:
  - Stat desc
  - Première ACF
  - Opérateur différence : détecter tendance et saisonnalité 
  -Suppression pour arriver à series stationnaires
  - Reg lin 
  - Etudes des résidus
  - ACF + PACF pour déterminer ordre des processus
